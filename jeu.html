<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histoire de France - Jeu Chronologique</title>
    <style>
        /* [Keep all the previous CSS styles] */
        /* ... (all the futuristic styles from before) ... */
    </style>
</head>
<body>
    <!-- [Keep all the HTML structure] -->
    <!-- ... (particles, header, game container, etc.) ... -->

    <script>
        // Game data with properly ordered historical events (oldest to newest)
        const events = [
            {
                title: "Assassinat François-Ferdinand",
                description: "Événement déclencheur de la Première Guerre mondiale.",
                date: "28 juin 1914",
                year: 1914,
                value: 1
            },
            {
                title: "Bataille de Verdun",
                description: "L'une des batailles les plus meurtrières de la Première Guerre mondiale.",
                date: "21 février - 18 décembre 1916",
                year: 1916,
                value: 2
            },
            {
                title: "Armistice 1918",
                description: "Fin des combats de la Première Guerre mondiale.",
                date: "11 novembre 1918",
                year: 1918,
                value: 3
            },
            {
                title: "Traité de Versailles",
                description: "Traité de paix mettant fin officiellement à la guerre.",
                date: "28 juin 1919",
                year: 1919,
                value: 4
            },
            {
                title: "Hitler chancelier",
                description: "Adolf Hitler devient chancelier d'Allemagne.",
                date: "30 janvier 1933",
                year: 1933,
                value: 5
            },
            {
                title: "Anschluss",
                description: "Annexion de l'Autriche par l'Allemagne nazie.",
                date: "12 mars 1938",
                year: 1938,
                value: 6
            },
            {
                title: "Pacte germano-soviétique",
                description: "Accord de non-agression entre Hitler et Staline.",
                date: "23 août 1939",
                year: 1939,
                value: 7
            },
            {
                title: "Invasion de la Pologne",
                description: "Début de la Seconde Guerre mondiale.",
                date: "1er septembre 1939",
                year: 1939,
                value: 8
            },
            {
                title: "Discours de Pétain",
                description: "Pétain annonce la demande d'armistice à la radio.",
                date: "17 juin 1940",
                year: 1940,
                value: 9
            },
            {
                title: "Appel du 18 Juin",
                description: "De Gaulle appelle à continuer le combat depuis Londres.",
                date: "18 juin 1940",
                year: 1940,
                value: 10
            },
            {
                title: "Armistice 1940",
                description: "Signature de l'armistice avec l'Allemagne nazie.",
                date: "22 juin 1940",
                year: 1940,
                value: 11
            },
            {
                title: "Débarquement Normandie",
                description: "Opération Overlord pour libérer la France.",
                date: "6 juin 1944",
                year: 1944,
                value: 12
            },
            {
                title: "Libération de Paris",
                description: "Fin de l'occupation allemande de la capitale.",
                date: "25 août 1944",
                year: 1944,
                value: 13
            },
            {
                title: "Capitulation allemande",
                description: "Fin de la Seconde Guerre mondiale en Europe.",
                date: "8 mai 1945",
                year: 1945,
                value: 14
            },
            {
                title: "Création de l'ONU",
                description: "Fondation des Nations unies.",
                date: "26 juin 1945",
                year: 1945,
                value: 15
            },
            {
                title: "Plan Marshall",
                description: "Aide américaine pour la reconstruction.",
                date: "5 juin 1947",
                year: 1947,
                value: 16
            },
            {
                title: "Création de l'OTAN",
                description: "Alliance militaire occidentale.",
                date: "4 avril 1949",
                year: 1949,
                value: 17
            },
            {
                title: "Traité de Rome",
                description: "Fondation de la CEE (future UE).",
                date: "25 mars 1957",
                year: 1957,
                value: 18
            },
            {
                title: "Mai 68",
                description: "Mouvement de protestation en France.",
                date: "Mai-juin 1968",
                year: 1968,
                value: 19
            },
            {
                title: "Chute du mur de Berlin",
                description: "Événement marquant la fin de la Guerre froide.",
                date: "9 novembre 1989",
                year: 1989,
                value: 20
            },
            {
                title: "Traité de Maastricht",
                description: "Fondation de l'Union européenne.",
                date: "7 février 1992",
                year: 1992,
                value: 21
            }
        ];

        // Game state variables
        let playerCards = [];
        let timelineCards = [];
        let gameWon = false;
        let draggedCard = null;
        let draggedCardIndex = null;

        // Initialize the game
        function initGame() {
            // Reset game state
            playerCards = [];
            timelineCards = [];
            gameWon = false;
            
            // Clear containers
            playerHand.innerHTML = '';
            timeline.innerHTML = '';
            winScreen.style.display = 'none';
            
            // Shuffle events but keep their chronological values
            const shuffledEvents = [...events].sort(() => Math.random() - 0.5);
            
            // Deal 3 cards to player (without dates)
            playerCards = shuffledEvents.slice(0, 3).map(card => {
                return {...card, showDate: false};
            });
            
            // Set first timeline card (with date visible)
            const firstTimelineCard = {...shuffledEvents[3], showDate: true};
            timelineCards.push(firstTimelineCard);
            
            updatePlayerHand();
            updateTimeline();
            
            showMessage("Glissez vos cartes sur la timeline dans l'ordre chronologique");
        }

        // Handle card drop on timeline - UPDATED with new placement rules
        function handleCardDrop(positionIndex) {
            // Get current min and max values on timeline
            const currentValues = timelineCards.map(card => card.value);
            const currentMin = Math.min(...currentValues);
            const currentMax = Math.max(...currentValues);
            
            // Check placement rules
            let validPlacement = false;
            
            if (positionIndex === -1) { // Placing before first card
                validPlacement = (draggedCard.value < currentMin);
            } 
            else if (positionIndex === timelineCards.length - 1) { // Placing after last card
                validPlacement = (draggedCard.value > currentMax);
            }
            else {
                // Not allowed to place between cards under these rules
                showMessage("Vous ne pouvez placer des cartes qu'aux extrémités de la timeline", 'error');
                return;
            }
            
            if (validPlacement) {
                // Correct placement
                const newCard = {
                    ...draggedCard, 
                    showDate: true
                };
                
                // Add to timeline
                timelineCards.push(newCard);
                
                // Remove from player's hand
                playerCards.splice(draggedCardIndex, 1);
                
                // Add new card to player's hand if available
                const remainingEvents = events.filter(event => 
                    !playerCards.some(pc => pc.title === event.title) &&
                    !timelineCards.some(tc => tc.title === event.title)
                );
                
                if (remainingEvents.length > 0 && playerCards.length < 3) {
                    const newPlayerCard = {...remainingEvents[0], showDate: false};
                    playerCards.push(newPlayerCard);
                }
                
                showMessage(`Correct ! ${newCard.title} (${newCard.date}) est bien placé.`, 'success');
                
                // Check win condition
                checkWinCondition();
            } else {
                // Incorrect placement
                showMessage(`Incorrect ! ${draggedCard.title} ne peut être placé ici.`, 'error');
            }
            
            // Reset dragged card
            draggedCard = null;
            draggedCardIndex = null;
            
            // Update displays
            updatePlayerHand();
            updateTimeline();
        }

        // Check win condition
        function checkWinCondition() {
            const remainingEvents = events.filter(event => 
                !playerCards.some(pc => pc.title === event.title) &&
                !timelineCards.some(tc => tc.title === event.title)
            );
            
            if (playerCards.length === 0 && remainingEvents.length === 0) {
                // Verify all cards are in correct order
                const sortedTimeline = [...timelineCards].sort((a, b) => a.value - b.value);
                const isCorrectOrder = timelineCards.every((card, index) => 
                    card.value === sortedTimeline[index].value);
                
                if (isCorrectOrder) {
                    setTimeout(winGame, 500);
                } else {
                    showMessage("Toutes les cartes sont placées mais l'ordre n'est pas correct !", 'error');
                }
            }
        }

        // [Keep all other functions the same]
        // updatePlayerHand(), updateTimeline(), createCardElement(), etc.

        // Start the game
        initGame();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histoire de France - Jeu Chronologique</title>
    <style>
        /* [Keep all the previous CSS styles] */
        /* ... (all the futuristic styles from before) ... */
    </style>
</head>
<body>
    <!-- [Keep all the HTML structure] -->
    <!-- ... (particles, header, game container, etc.) ... -->

    <script>
        // Game data with properly ordered historical events (oldest to newest)
        const events = [
            {
                title: "Assassinat François-Ferdinand",
                description: "Événement déclencheur de la Première Guerre mondiale.",
                date: "28 juin 1914",
                year: 1914,
                placementValue: 1.0
            },
            {
                title: "Bataille de Verdun",
                description: "L'une des batailles les plus meurtrières de la Première Guerre mondiale.",
                date: "21 février - 18 décembre 1916",
                year: 1916,
                placementValue: 2.0
            },
            {
                title: "Armistice 1918",
                description: "Fin des combats de la Première Guerre mondiale.",
                date: "11 novembre 1918",
                year: 1918,
                placementValue: 3.0
            },
            {
                title: "Traité de Versailles",
                description: "Traité de paix mettant fin officiellement à la guerre.",
                date: "28 juin 1919",
                year: 1919,
                placementValue: 4.0
            },
            {
                title: "Hitler chancelier",
                description: "Adolf Hitler devient chancelier d'Allemagne.",
                date: "30 janvier 1933",
                year: 1933,
                placementValue: 5.0
            },
            {
                title: "Anschluss",
                description: "Annexion de l'Autriche par l'Allemagne nazie.",
                date: "12 mars 1938",
                year: 1938,
                placementValue: 6.0
            },
            {
                title: "Pacte germano-soviétique",
                description: "Accord de non-agression entre Hitler et Staline.",
                date: "23 août 1939",
                year: 1939,
                placementValue: 7.0
            },
            {
                title: "Invasion de la Pologne",
                description: "Début de la Seconde Guerre mondiale.",
                date: "1er septembre 1939",
                year: 1939,
                placementValue: 7.1
            },
            {
                title: "Discours de Pétain",
                description: "Pétain annonce la demande d'armistice à la radio.",
                date: "17 juin 1940",
                year: 1940,
                placementValue: 8.0
            },
            {
                title: "Appel du 18 Juin",
                description: "De Gaulle appelle à continuer le combat depuis Londres.",
                date: "18 juin 1940",
                year: 1940,
                placementValue: 8.1
            },
            {
                title: "Armistice 1940",
                description: "Signature de l'armistice avec l'Allemagne nazie.",
                date: "22 juin 1940",
                year: 1940,
                placementValue: 8.2
            },
            {
                title: "Débarquement Normandie",
                description: "Opération Overlord pour libérer la France.",
                date: "6 juin 1944",
                year: 1944,
                placementValue: 9.0
            },
            {
                title: "Libération de Paris",
                description: "Fin de l'occupation allemande de la capitale.",
                date: "25 août 1944",
                year: 1944,
                placementValue: 9.1
            },
            {
                title: "Capitulation allemande",
                description: "Fin de la Seconde Guerre mondiale en Europe.",
                date: "8 mai 1945",
                year: 1945,
                placementValue: 9.2
            },
            {
                title: "Création de l'ONU",
                description: "Fondation des Nations unies.",
                date: "26 juin 1945",
                year: 1945,
                placementValue: 9.3
            },
            {
                title: "Plan Marshall",
                description: "Aide américaine pour la reconstruction.",
                date: "5 juin 1947",
                year: 1947,
                placementValue: 9.4
            },
            {
                title: "Création de l'OTAN",
                description: "Alliance militaire occidentale.",
                date: "4 avril 1949",
                year: 1949,
                placementValue: 9.5
            },
            {
                title: "Traité de Rome",
                description: "Fondation de la CEE (future UE).",
                date: "25 mars 1957",
                year: 1957,
                placementValue: 9.6
            },
            {
                title: "Mai 68",
                description: "Mouvement de protestation en France.",
                date: "Mai-juin 1968",
                year: 1968,
                placementValue: 9.7
            },
            {
                title: "Chute du mur de Berlin",
                description: "Événement marquant la fin de la Guerre froide.",
                date: "9 novembre 1989",
                year: 1989,
                placementValue: 9.8
            },
            {
                title: "Traité de Maastricht",
                description: "Fondation de l'Union européenne.",
                date: "7 février 1992",
                year: 1992,
                placementValue: 9.9
            }
        ];

        // Game state variables
        let playerCards = [];
        let timelineCards = [];
        let gameWon = false;
        let draggedCard = null;
        let draggedCardIndex = null;

        // DOM elements
        const playerHand = document.getElementById('player-hand');
        const timeline = document.getElementById('timeline');
        const messageArea = document.getElementById('message-area');
        const winScreen = document.getElementById('win-screen');
        const playAgainButton = document.getElementById('play-again');

        // Initialize the game
        function initGame() {
            // Reset game state
            playerCards = [];
            timelineCards = [];
            gameWon = false;
            
            // Clear containers
            playerHand.innerHTML = '';
            timeline.innerHTML = '';
            winScreen.style.display = 'none';
            
            // Shuffle events but keep their chronological order values
            const shuffledEvents = [...events].sort(() => Math.random() - 0.5);
            
            // Deal 3 cards to player (without dates)
            playerCards = shuffledEvents.slice(0, 3).map(card => {
                return {...card, showDate: false};
            });
            
            // Set first timeline card (with date visible)
            const firstTimelineCard = {...shuffledEvents[3], showDate: true};
            timelineCards.push(firstTimelineCard);
            
            updatePlayerHand();
            updateTimeline();
            
            showMessage("Glissez vos cartes sur la timeline dans l'ordre chronologique");
        }

        // [Keep all the previous helper functions]
        // updatePlayerHand(), updateTimeline(), createCardElement(), etc.

        // Handle card drop on timeline - UPDATED with better validation
        function handleCardDrop(positionIndex) {
            // Determine the correct position based on placementValue
            let correctPosition = false;
            let newPlacementValue = 0;
            
            if (timelineCards.length === 0) {
                // First card on timeline
                correctPosition = true;
                newPlacementValue = draggedCard.placementValue;
            } else if (positionIndex === -1) {
                // Placing before first card
                correctPosition = draggedCard.placementValue < timelineCards[0].placementValue;
                newPlacementValue = timelineCards[0].placementValue - 0.1;
            } else if (positionIndex === timelineCards.length - 1) {
                // Placing after last card
                correctPosition = draggedCard.placementValue > timelineCards[timelineCards.length - 1].placementValue;
                newPlacementValue = timelineCards[timelineCards.length - 1].placementValue + 0.1;
            } else {
                // Placing between two cards
                const prevCard = timelineCards[positionIndex];
                const nextCard = timelineCards[positionIndex + 1];
                correctPosition = (draggedCard.placementValue > prevCard.placementValue && 
                                  draggedCard.placementValue < nextCard.placementValue);
                newPlacementValue = (prevCard.placementValue + nextCard.placementValue) / 2;
            }
            
            if (correctPosition) {
                // Correct placement
                const newCard = {
                    ...draggedCard, 
                    showDate: true,
                    placementValue: newPlacementValue
                };
                
                // Add to timeline
                timelineCards.push(newCard);
                
                // Remove from player's hand
                playerCards.splice(draggedCardIndex, 1);
                
                // Add new card to player's hand if available
                const remainingEvents = events.filter(event => 
                    !playerCards.some(pc => pc.title === event.title) &&
                    !timelineCards.some(tc => tc.title === event.title)
                );
                
                if (remainingEvents.length > 0 && playerCards.length < 3) {
                    const newPlayerCard = {...remainingEvents[0], showDate: false};
                    playerCards.push(newPlayerCard);
                }
                
                showMessage(`Correct ! ${newCard.title} (${newCard.date}) est bien placé.`, 'success');
                
                // Check win condition
                checkWinCondition();
            } else {
                // Incorrect placement
                showMessage(`Incorrect ! ${draggedCard.title} (${draggedCard.date}) ne va pas ici.`, 'error');
            }
            
            // Reset dragged card
            draggedCard = null;
            draggedCardIndex = null;
            
            // Update displays
            updatePlayerHand();
            updateTimeline();
        }

        // New function to check win condition
        function checkWinCondition() {
            // Check if all cards are placed and in correct order
            const remainingEvents = events.filter(event => 
                !playerCards.some(pc => pc.title === event.title) &&
                !timelineCards.some(tc => tc.title === event.title)
            );
            
            if (playerCards.length === 0 && remainingEvents.length === 0) {
                // Verify all cards are in correct order
                const sortedTimeline = [...timelineCards].sort((a, b) => a.placementValue - b.placementValue);
                const isCorrectOrder = timelineCards.every((card, index) => 
                    card.placementValue === sortedTimeline[index].placementValue);
                
                if (isCorrectOrder) {
                    setTimeout(winGame, 500);
                } else {
                    showMessage("Toutes les cartes sont placées mais l'ordre n'est pas correct !", 'error');
                }
            }
        }

        // [Keep all other functions the same]
        // showMessage(), winGame(), etc.

        // Event listeners
        playAgainButton.addEventListener('click', initGame);

        // Start the game
        initGame();
    </script>
</body>
</html>
